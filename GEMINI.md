# 프로젝트: Vocabulario Inteligente (지능형 어휘 학습)

## 1. 프로젝트 비전 및 핵심 철학 (Vision & Core Philosophy)

-   **한 줄 비전:** 언어학, 인지과학, AI, 최신 SRS(FSRS) 알고리즘을 융합하여 **'가장 효율적이고 즐거운'** 스페인어 어휘 학습 경험을 제공하는 지능형 학습 동반자.
-   **핵심 철학:**
    1.  **동기 부여의 문제:** 시각적 성취감(지식의 피라미드), 게임화, 진척도 그라데이션, 개인화된 피드백으로 극복
    2.  **학습 효율성의 문제:** FSRS 기반의 과학적 간격 반복, 개인별 맞춤 복습, 암기 정도의 연속적 추적/시각화
    3.  **인지 부하의 문제:** AI 기반 동적 예문, 이미 아는 단어/문법만 활용한 예문 생성, 인지 장벽 최소화

## 2. 주요 기능 및 아이디어 (Feature & Ideation)

-   **지식의 피라미드 대시보드:**
    -   5,000개 단어를 계층별로 시각화, 품사별 그룹핑, 진도/암기 정도에 따라 색상 그라데이션
    -   각 단어 박스는 품사별 색상 + 암기 정도(예상 기억률, FSRS 기반)를 채도/밝기로 시각화
    -   단어 클릭 시 상세 정보(스페인어, 품사, 한글/영어 뜻, 예문, 학습 상태 등) 모달 표시
    -   단어별 체크(완료) 표시: 체크 클릭 시 색상 초록(완료), DB status 업데이트
-   **학습/복습 알고리즘:**
    -   FSRS(Flexible Spaced Repetition Schedule) 알고리즘 도입
    -   각 단어별로 암기 정도(예상 기억률, stability 등)를 연속적으로 추적
    -   복습 필요 단어 자동 선정, 맞춤형 복습 스케줄 제공
    -   암기 정도를 색상 그라데이션(회색→연초록→진초록)으로 시각화
-   **학습 모드:**
    -   플래시카드, 객관식, 타이핑, 빈칸 채우기 등 다양한 모드
    -   학습/복습 결과는 user_word_progress/FSRS에 반영
-   **AI 동적 예문:**
    -   Gemini API로, 사용자가 이미 아는 단어/문법만 활용한 예문 실시간 생성
    -   단어 상세 모달에 예문/번역 표시
-   **통계/동기부여:**
    -   전체/계층별 진도율, 암기 분포, 연속 학습일, 품사별/분류별 통계
    -   뱃지/업적 시스템, 학습 기록 캘린더(잔디밭)

## 3. 기술 아키텍처 및 데이터 (Tech & Data)

-   **기술 스택:** React, Supabase(PostgreSQL, Auth, Edge Functions), Gemini API, PWA, FSRS-js
-   **DB 스키마:**
    -   words: id, frequency_rank, spanish, part_of_speech, english_meaning, korean, ...
    -   user_word_progress: user_id, word_id, status, last_reviewed_at, next_review_at, correct_streak, ease_factor, ...
-   **FSRS 적용:**
    -   각 단어별로 암기 정도(예상 기억률 등)를 계산, 색상 그라데이션으로 시각화
    -   복습/학습 이벤트 발생 시 FSRS로 상태 갱신, DB에 반영

## 4. 개발 로드맵 및 세부 계획 (Roadmap & Detailed Plan)

### [A] 대시보드/피라미드 고도화
- [x] 피라미드 전체/계층 뷰 및 품사별/빈도수별 정렬 기능 구현
- [x] 암기율(FSRS) 기반 그라데이션 색상 적용 (전체 뷰, 계층 뷰)
- [x] 단어 클릭 시 상세 정보 모달 및 FSRS 기반 암기 정도 표시
- [x] 단어별 체크(완료) 기능 (현재는 UI만, DB 연동 필요)
- [x] 전체/계층별 진도율 및 통계 표시
- [ ] 전체/계층 뷰 전환 및 품사별 그룹핑에 자연스러운 애니메이션 적용
- [ ] 코드 리팩토링 및 성능 최적화 (진행 중)

### [B] 학습/복습 알고리즘(FSRS) 도입
- [x] fsrs-js 라이브러리 도입 및 단어별 암기 정도 계산
- [x] 학습/복습 이벤트 발생 시 FSRS로 상태 갱신, DB 반영
- [ ] 오늘 복습할 단어 자동 선정(스케줄)
- [x] 암기 정도(예상 기억률 등) 기반 시각화/통계

### [C] 학습 모드/AI 예문/통계 고도화
- [ ] 플래시카드/퀴즈/타이핑 등 다양한 학습 모드 구현
- [ ] Gemini API 연동, 동적 예문 생성 및 모달/학습화면에 표시
- [ ] 전체/계층/품사별 진도율, 암기 분포, 연속 학습일, 뱃지/업적 등 통계/동기부여 기능

### [D] AI 동적 예문 생성 시스템 구축 (상세 계획)

#### 1. 목표 (Goals)

-   **개인화 (Personalization):** 사용자의 FSRS 학습 상태(아는 단어)를 기반으로 동적으로 예문을 생성하여, 인지 부하를 최소화하고 자연스러운 복습을 유도한다.
-   **사용자 제어권 (User Control):** 사용자가 직접 예문 생성 범위를 설정(수동 생성)하거나, 시스템에 자동 업데이트를 위임할 수 있는 옵션을 제공한다.
-   **비용 효율성 (Cost-Effectiveness):** API 호출을 최소화하고, 무료 사용량 범위 내에서 운영될 수 있도록 'On-Demand 생성' 및 '조건부 재 생성' 모델을 채택한다.
-   **오프라인 지원 (Offline Support):** 한 번 생성된 예문은 로컬(IndexedDB)에 캐싱하여 오프라인에서도 접근 가능하도록 한다.

#### 2. 기술 아키텍처 (Architecture)

-   **프론트엔드 (React):**
    -   `설정` 페이지 UI: 예문 생성 관련 모든 옵션(활성화, 자동/수동 설정) 제공.
    -   `단어 상세 모달` UI: 예문 표시, 생성 요청, 업데이트 버튼 등 상호작용 담당.
    -   로컬 DB 관리 (`IndexedDB`): `dexie.js` 등의 라이브러리를 활용하여 `generated_examples` 테이블 관리 및 Supabase와 동기화.
-   **백엔드 (Supabase):**
    -   **Database:**
        -   `generated_examples` 테이블 신설: 생성된 예문과 관련 메타데이터 저장.
        -   `example_generation_jobs` 테이블 신설: 예문 생성/업데이트 작업을 큐(Queue)로 관리.
    -   **Edge Functions:**
        -   `create-example-job`: 사용자의 수동 생성 요청을 받아 `jobs` 테이블에 작업을 등록하는 함수.
        -   `process-example-queue`: 주기적으로(Cron Job) `jobs` 테이블을 확인하고, `pending` 상태인 작업을 처리하여 Gemini API를 호출하고 결과를 DB에 저장하는 핵심 로직.
-   **AI (Google Gemini API):**
    -   정교하게 설계된 프롬프트를 기반으로, 주어진 조건에 맞는 예문과 번역을 JSON 형식으로 생성.

#### 3. 개발 로드맵 (Phased Rollout)

**Phase 1: 기반 구축 (DB & API 연동)**

-   [ ] **DB 설계:** Supabase에 `generated_examples`, `example_generation_jobs` 두 테이블을 설계하고 생성한다. (컬럼 상세 내용은 이전 대화 참고)
-   [ ] **Gemini API 연동:** Supabase Edge Function 내에서 Gemini API를 호출하는 기본 함수를 작성하고 테스트한다. (API 키는 환경 변수로 안전하게 관리)
-   [ ] **프롬프트 엔지니어링 (v1):** 목표 단어와 '아는 단어 목록'을 받아 예문을 생성하는 기본 프롬프트를 설계한다.

**Phase 2: MVP 기능 구현 (수동 생성 및 표시)**

-   [ ] **UI 구현 (단어 상세 모달):**
    -   [ ] 예문이 없을 경우, [AI 예문 보기] 버튼을 표시한다.
    -   [ ] 버튼 클릭 시, 로딩 상태(플레이스홀더)를 표시하고 백엔드에 예문 생성을 요청한다. (Edge Function 호출)
    -   [ ] 예문이 존재할 경우, DB에서 가져와 표시한다.
-   [ ] **백엔드 로직 (MVP):**
    -   [ ] 'Job Queue'를 간소화하여, 요청 시 즉시 API를 호출하고 `generated_examples`에 저장하는 방식으로 우선 구현한다. (실시간이지만, UX 지연 가능성 있음)
-   [ ] **로컬 캐싱 (IndexedDB):** 생성된 예문을 로컬 DB에 저장하여, 다음 조회부터는 즉시 표시되도록 한다.

**Phase 3: 고급 기능 구현 (설정 페이지 & Job Queue)**

-   [ ] **UI 구현 (설정 페이지):**
    -   [ ] 기능 On/Off, 자동 업데이트 On/Off, 업데이트 민감도 설정 UI를 구현한다.
    -   [ ] 수동 생성을 위한 '목표 단어' 및 '재료 단어' 범위 선택 UI를 구현한다.
    -   [ ] [예문 생성 작업 시작] 버튼 및 작업 내역(History) 표시 영역을 구현한다.
-   [ ] **Job Queue 시스템 고도화:**
    -   [ ] Phase 2의 실시간 로직을 완전한 Job Queue 방식으로 전환한다.
    -   [ ] `create-example-job` Edge Function을 구현하여 사용자의 수동 요청을 `jobs` 테이블에 등록한다.
    -   [ ] `process-example-queue` Cron Job Function을 구현하여, 예약된 작업을 순차적으로 안정적으로 처리한다.
-   [ ] **자동 업데이트 로직 구현:** 앱 시작 또는 특정 시점에 사용자의 학습 성장을 체크하고, 조건 충족 시 자동으로 `jobs` 테이블에 작업을 등록하는 로직을 추가한다.

**Phase 4: 최종 UX 개선 및 배포**

-   [ ] **실시간 알림:** 예문 생성이 완료되었을 때 사용자에게 알려주는 토스트 메시지 또는 알림 기능을 추가한다.
-   [ ] **UI 개선:** 단어 모달에 '더 나은 예문으로 업데이트하기' 버튼 로직을 구현한다.
-   [ ] **오류 처리:** API 호출 실패, 타임아웃 등 예외 상황에 대한 처리 로직을 견고하게 추가한다.
-   [ ] **성능 테스트 및 최적화:** 전체 시스템의 성능을 테스트하고 병목 현상을 개선한다.

---

## 5. 다음 작업 우선순위 (Next Steps)

1. **단어 상세 모달 고도화**
    - 영어 뜻, 예문, 암기 정도(색상/수치), 체크(완료) 표시, DB 연동
2. **FSRS-js 도입 및 단어별 암기 정도 계산/시각화**
3. **복습/학습 이벤트 → FSRS 상태 갱신/DB 반영**
4. **계층/전체 뷰 애니메이션/UX 고도화**
5. **통계/동기부여/AI 예문 등 부가 기능**

---

## 6. 참고/메모
- FSRS: https://github.com/open-spaced-repetition/fsrs-js
- 암기 정도 시각화: recall probability → HSL 색상 그라데이션
- 단어별 체크/완료: status === 'completed' → 초록색, 체크 아이콘
- 영어 뜻: english_meaning 필드 활용
- 예문: Gemini API, 또는 words 테이블 확장

---

## 단어분류기준

✅ **A그룹: 영어와 유사하여 쉽게 학습할 수 있는 단어**
영어의 지식을 활용해 의미, 철자, 발음을 쉽게 유추할 수 있는 단어 그룹입니다.
 * 레벨 1: 명백한 동족어 (Obvious Cognates)
   * 1-A (완전 동일형): 철자가 완전히 같아 즉시 인식 가능한 단어.
     * 예: animal, social, hotel, control, general
   * 1-B (유사 동일형): 악센트나 한두 글자 차이로 거의 동일하게 보이는 단어.
     * 예: música (music), familia (family), número (number), posible (possible)
 * 레벨 2: 예측 가능한 패턴의 동족어 (Predictable Pattern Cognates)
   * 영어와 스페인어 사이의 일정한 철자 변환 규칙을 따르는 단어. 이 패턴을 익히면 수많은 단어를 쉽게 익힐 수 있습니다.
   * -ción → -tion: nación (nation), atención (attention)
   * -dad → -ty: ciudad (city), universidad (university)
   * -oso → -ous: famoso (famous), curioso (curious)
   * -mente → -ly: finalmente (finally), normalmente (normally)
   * es- + (s+자음): especial (special), estudiante (student)
   * -ia/-io → -y: historia (history), democracia (democracy)
   * 기타 유사 패턴: perfecto (perfect), diferente (different)
 * 레벨 3: 어근을 공유하는 동족어 (Shared Root Cognates)
   * 일상적인 영어 단어와는 바로 연결되지 않지만, 조금 더 깊은 어원(라틴어 등)을 공유하여 영어의 다른 단어와 연결하면 유추가 가능한 단어. 학습자의 어휘력에 따라 B그룹으로 느껴질 수도 있습니다.
   * 예: escribir (write) → scribe, mano (hand) → manual, pie (foot) → pedestrian, cuerpo (body) → corpse, ver (see) → vision
 * 레벨 4: 실용적 유사어 (Practical Look-alikes)
   * 정의: 어원은 다르지만, 우연히 철자나 발음이 영어 단어와 매우 흡사하여 학습에 직접적인 도움이 되는 단어.
   * 예시: día ↔ day

⛔ **B그룹: 영어와 비유사하여 암기가 필요한 단어**
영어 지식만으로는 의미를 유추하기 어려워 별도의 암기가 필요한 단어 그룹입니다.
 * 레벨 1: 핵심 기능어 (Function Words)
   * 문법적 기능을 하는 고빈도 단어들로, 대부분의 언어에서 고유한 형태를 가집니다.
   * 예: de (of), que (that), y (and), a (to), el/la (the), por (for), pero (but)
 * 레벨 2: 어원적 연관성이 낮은 핵심 어휘 (Unrelated Core Vocabulary)
   * 일상생활에서 매우 자주 쓰이지만, 영어와 어원이 달라 직관적 연상이 어려운 기초 단어들.
   * 예: ser/estar (to be), ir (to go), casa (house), mujer (woman), vida (life), bueno (good), agua (water), día (day)
 * ⚠️ 레벨 3: 거짓 친구 (False Friends) - 특별 주의!
   * 철자는 A그룹처럼 유사하지만 의미가 완전히 달라 학습자를 함정에 빠뜨릴 수 있는 단어들. 이 그룹은 따로 목록을 만들어 집중적으로 암기하는 것이 매우 중요합니다.
   * 예: éxito (success, not exit), sopa (soup, not soap), ropa (clothes, not rope), largo (long, not large), asistir (to attend, not to assist)

---

## 7. 학습(LEARN) 메뉴 고도화 계획

### ⭐️ 목표
- **끝내주는 UI/UX**: 기존 애플 스타일 + 듀오링고의 직관적이고 세련된 인터랙션, 시각적 몰입감, 애니메이션, 피드백, 성취감 극대화
- **모바일 최적화**: 모바일/태블릿 환경에서 앱처럼 자연스럽게 동작하도록 반응형 설계, 터치/제스처/애니메이션 등 모바일 UX 고려
- **핵심 알고리즘과 유기적 연동**: FSRS 기반 맞춤 복습, DB 구조, 진도/통계, 개인화 피드백 등과 완벽하게 연결

### 🏗️ 개발 로드맵
1. **플래시카드 모드 UI/UX 리디자인**
    - 카드 뒤집기, 스와이프, 애니메이션, 색상 피드백, 진도/암기 정도 시각화
    - 모바일 터치/스와이프 UX, 반응형 레이아웃
    - FSRS 상태/진도와 실시간 연동
2. **퀴즈(객관식) 모드 고도화 및 활성화**
    - 듀오링고 스타일 4지선다, 즉각적 피드백, 애니메이션, 정답/오답 효과
    - 모바일 UX, 진도/점수/통계 시각화
    - FSRS/DB 연동, 오답노트/복습 추천
3. **학습 세션 커스터마이즈/복습 우선순위**
    - 오늘 복습할 단어 자동 선정, 범위/난이도/필터 선택, 맞춤 세션
    - 세션별/누적 통계, 성취/뱃지/피드백
4. **신규 모드(타이핑, 동사변화 등) 단계적 추가**
    - 모바일/웹 모두에서 직관적이고 재밌는 UX
    - FSRS/DB/통계와 연동

### ✅ 명심할 점
1. **끝내주는 UI/UX**: 애플+듀오링고 스타일, 직관적이고 몰입감 있는 인터랙션, 시각적 피드백, 애니메이션, 성취감
2. **모바일 최적화**: 앱 수준의 반응형, 터치/스와이프/제스처, 모바일 우선 설계
3. **FSRS/DB/로직과 유기적 연결**: 학습/복습/통계/피드백이 모두 알고리즘과 실시간 연동

---

## 8. 학습 메뉴 고도화 TODO
- [x] **학습 메뉴 UI 구현 및 활성화:** 3가지 모드(플래시카드, 퀴즈, 동사연습) 메뉴 구현 및 스크롤 문제 해결
- [x] **플래시카드 모드 (1차 완성):**
  - [x] 세션 설정 (추천/복습/레벨 선택, 개수 조절)
  - [x] FSRS 연동 (난이도 버튼 클릭 시 상태 업데이트 및 DB 저장)
  - [x] 핵심 UI/UX (카드 뒤집기, 스와이프, 진행률, 암기율 시각화)
  - [x] 세션 결과 및 오답노트 표시
- [x] **객관식 퀴즈 모드 (1차 완성):**
  - [x] 플래시카드와 세션 설정 기능 연동
  - [x] 4지선다 퀴즈 로직 및 즉각적 피드백 구현
  - [x] FSRS 연동 (정답/오답 시 상태 업데이트)
  - [x] 세션 결과 (정답률, 개수) 표시
- [x] **동사 변화 연습 모드 (1차 완성):**
  - [x] 객관식/타이핑 2가지 모드 구현
  - [x] 동사 데이터 기반 문제 생성 및 정답/오답 피드백
  - [x] FSRS 연동 (정답/오답 시 상태 업데이트)
- [ ] **학습 모드 공통 개선:**
  - [ ] 듀오링고 스타일의 정교한 애니메이션 및 사운드 피드백 추가
  - [ ] 세션별/누적 통계, 오답노트, 성취/뱃지 시스템 연동 강화
  - [ ] 오늘 복습할 단어 자동 선정 및 푸시 알림 기능
- [ ] **신규 학습 모드(타이핑, 문장 만들기 등) 설계 및 1차 구현**

---